{"version":3,"file":"compiler.js","sources":["../src/handleErrors.js","../src/compiler.js","../src/CompilerHost.js"],"sourcesContent":["import chalk from 'chalk';\nimport { getPreEmitDiagnostics, DiagnosticCategory, flattenDiagnosticMessageText } from 'typescript';\n\n// Shamelessly copied from https://github.com/Microsoft/TypeScript/wiki/Using-the-Compiler-API#a-minimal-compiler\nfunction handleErrors( program, emitResult ) {\n\tconst diagnostics = getPreEmitDiagnostics( program ).concat( emitResult.diagnostics );\n\tlet errored = false;\n\n\tdiagnostics.forEach( ( diagnostic ) => {\n\t\tconst { line, character } = diagnostic.file.getLineAndCharacterOfPosition( diagnostic.start );\n\t\tconst message = flattenDiagnosticMessageText( diagnostic.messageText, '\\n' );\n\t\tlet prefix = chalk.blue( '[Info]' );\n\t\tlet method = 'log';\n\n\t\tif ( diagnostic.category === DiagnosticCategory.Warning ) {\n\t\t\tprefix = chalk.yellow( '[Warning]' );\n\t\t\tmethod = 'warn';\n\t\t} else if ( diagnostic.category === DiagnosticCategory.Error ) {\n\t\t\tprefix = chalk.red( '[Error]' );\n\t\t\tmethod = 'error';\n\n\t\t\terrored = true;\n\t\t}\n\n\t\tconsole[ method ]( `${ prefix } ${ diagnostic.file.fileName } (${ line + 1 },${ character + 1 }): ${message}` ); // eslint-disable-line no-console\n\t} );\n\n\tif ( errored || emitResult.emitSkipped ) {\n\t\tthrow new Error( 'Compilation was unsuccessful!' );\n\t}\n}\n\nexport default handleErrors;\n","import { createProgram } from 'typescript';\nimport CompilerHost from './CompilerHost';\nimport handleErrors from './handleErrors';\n\nfunction compiler( files, options = {} ) {\n\tconst vfs = Object.assign( {}, files );\n\tconst compilerHost = new CompilerHost( vfs );\n\tconst program = createProgram( options.entry || [ 'index.ts' ], options, compilerHost );\n\n\tconst result = program.emit();\n\n\thandleErrors( program, result );\n\n\t// MUTATING STATE â€“ SO WRONG!!!\n\treturn vfs;\n}\n\nexport default compiler;\n","import { readFileSync, existsSync } from 'fs';\nimport { createSourceFile, getDefaultLibFilePath } from 'typescript';\n\nclass CompilerHost {\n\tconstructor( files ) {\n\t\tif ( !files || typeof files !== 'object' || Array.isArray( files ) ) {\n\t\t\tthrow new TypeError( 'First parameter must be an object.' );\n\t\t}\n\n\t\tthis.files = files;\n\t}\n\n\tfileExists( fileName ) {\n\t\tif ( typeof this.files[ fileName ] !== 'undefined' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn existsSync( fileName );\n\t}\n\n\tgetCanonicalFileName( fileName ) {\n\t\treturn String( fileName );\n\t}\n\n\tgetCurrentDirectory() {\n\t\treturn '';\n\t}\n\n\tgetDefaultLibFileName( options ) {\n\t\treturn getDefaultLibFilePath( options );\n\t}\n\n\tgetNewLine() {\n\t\treturn '\\n';\n\t}\n\n\tgetSourceFile( fileName, languageVersion ) {\n\t\tconst content = fileName.indexOf( 'lib.d.ts' ) !== -1 && fileName.indexOf( '/' ) !== -1 ?\n\t\t\treadFileSync( fileName, 'utf8' ) : this.files[ fileName ];\n\n\t\treturn createSourceFile( fileName, content, languageVersion, '1.0', true );\n\t}\n\n\tuseCaseSensitiveFileNames() {\n\t\treturn true;\n\t}\n\n\twriteFile( fileName, data ) {\n\t\tthis.files[ fileName ] = data;\n\t}\n}\n\nexport default CompilerHost;\n"],"names":["handleErrors","program","emitResult","diagnostics","getPreEmitDiagnostics","concat","errored","forEach","diagnostic","file","getLineAndCharacterOfPosition","start","line","character","message","flattenDiagnosticMessageText","messageText","prefix","chalk","blue","method","category","DiagnosticCategory","Warning","yellow","Error","red","fileName","emitSkipped","compiler","files","options","vfs","Object","assign","compilerHost","CompilerHost","createProgram","entry","emit","Array","isArray","TypeError","this","existsSync","String","getDefaultLibFilePath","languageVersion","content","indexOf","readFileSync","createSourceFile","data"],"mappings":";iGAIA,QAASA,cAAcC,EAASC,MACzBC,GAAcC,iCAAuBH,GAAUI,OAAQH,EAAWC,aACpEG,GAAU,OAEFC,QAAS,SAAEC,SACMA,EAAWC,KAAKC,8BAA+BF,EAAWG,OAA9EC,IAAAA,KAAMC,IAAAA,UACRC,EAAUC,wCAA8BP,EAAWQ,YAAa,MAClEC,EAASC,MAAMC,KAAM,UACrBC,EAAS,KAERZ,GAAWa,WAAaC,8BAAmBC,WACtCL,MAAMM,OAAQ,eACd,QACEhB,EAAWa,WAAaC,8BAAmBG,UAC7CP,MAAMQ,IAAK,aACX,WAEC,WAGFN,GAAcH,MAAYT,EAAWC,KAAKkB,eAAef,EAAO,QAAOC,EAAY,SAAQC,KAGhGR,GAAWJ,EAAW0B,iBACpB,IAAIH,OAAO,iCCxBnB,QAASI,YAAUC,MAAOC,6DACnBC,EAAMC,OAAOC,UAAYJ,GACzBK,EAAe,GAAIC,cAAcJ,GACjC/B,EAAUoC,yBAAeN,EAAQO,QAAW,YAAcP,EAASI,uBAI3DlC,EAFCA,EAAQsC,QAKhBP,otBCXFI,mCACQN,8BACNA,GAA0B,qBAAVA,sBAAAA,KAAsBU,MAAMC,QAASX,QACpD,IAAIY,WAAW,2CAGjBZ,MAAQA,yDAGFH,SAC4B,UAA3BgB,KAAKb,MAAOH,IAIjBiB,cAAYjB,gDAGEA,SACdkB,QAAQlB,uDAIR,iDAGeI,SACfe,kCAAuBf,8CAIvB,2CAGOJ,EAAUoB,MAClBC,GAAUrB,EAASsB,QAAS,eAAkB,GAAKtB,EAASsB,QAAS,QAAW,EACrFC,gBAAcvB,EAAU,QAAWgB,KAAKb,MAAOH,SAEzCwB,6BAAkBxB,EAAUqB,EAASD,EAAiB,OAAO,8DAI7D,oCAGGpB,EAAUyB,QACftB,MAAOH,GAAayB"}