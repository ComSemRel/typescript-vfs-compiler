{"version":3,"file":"compiler.es2015.js","sources":["../src/CompilerHost.js","../src/handleErrors.js","../src/compiler.js"],"sourcesContent":["import { readFileSync, existsSync } from 'fs';\nimport { createSourceFile, getDefaultLibFilePath } from 'typescript';\n\nclass CompilerHost {\n\tconstructor( files ) {\n\t\tif ( !files || typeof files !== 'object' || Array.isArray( files ) ) {\n\t\t\tthrow new TypeError( 'First parameter must be an object.' );\n\t\t}\n\n\t\tthis.files = files;\n\t}\n\n\tfileExists( fileName ) {\n\t\tif ( typeof this.files[ fileName ] !== 'undefined' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn existsSync( fileName );\n\t}\n\n\tgetCanonicalFileName( fileName ) {\n\t\treturn String( fileName );\n\t}\n\n\tgetCurrentDirectory() {\n\t\treturn '';\n\t}\n\n\tgetDefaultLibFileName( options ) {\n\t\treturn getDefaultLibFilePath( options );\n\t}\n\n\tgetNewLine() {\n\t\treturn '\\n';\n\t}\n\n\tgetSourceFile( fileName, languageVersion ) {\n\t\tconst content = fileName.indexOf( 'lib.d.ts' ) !== -1 && fileName.indexOf( '/' ) !== -1 ?\n\t\t\treadFileSync( fileName, 'utf8' ) : this.files[ fileName ];\n\n\t\treturn createSourceFile( fileName, content, languageVersion, '1.0', true );\n\t}\n\n\tuseCaseSensitiveFileNames() {\n\t\treturn true;\n\t}\n\n\twriteFile( fileName, data ) {\n\t\tthis.files[ fileName ] = data;\n\t}\n}\n\nexport default CompilerHost;\n","import chalk from 'chalk';\nimport { getPreEmitDiagnostics, DiagnosticCategory, flattenDiagnosticMessageText } from 'typescript';\n\n// Shamelessly copied from https://github.com/Microsoft/TypeScript/wiki/Using-the-Compiler-API#a-minimal-compiler\nfunction handleErrors( program, emitResult ) {\n\tconst diagnostics = getPreEmitDiagnostics( program ).concat( emitResult.diagnostics );\n\tlet errored = false;\n\n\tdiagnostics.forEach( ( diagnostic ) => {\n\t\tconst { line, character } = diagnostic.file.getLineAndCharacterOfPosition( diagnostic.start );\n\t\tconst message = flattenDiagnosticMessageText( diagnostic.messageText, '\\n' );\n\t\tlet prefix = chalk.blue( '[Info]' );\n\t\tlet method = 'log';\n\n\t\tif ( diagnostic.category === DiagnosticCategory.Warning ) {\n\t\t\tprefix = chalk.yellow( '[Warning]' );\n\t\t\tmethod = 'warn';\n\t\t} else if ( diagnostic.category === DiagnosticCategory.Error ) {\n\t\t\tprefix = chalk.red( '[Error]' );\n\t\t\tmethod = 'error';\n\n\t\t\terrored = true;\n\t\t}\n\n\t\tconsole[ method ]( `${ prefix } ${ diagnostic.file.fileName } (${ line + 1 },${ character + 1 }): ${message}` ); // eslint-disable-line no-console\n\t} );\n\n\tif ( errored || emitResult.emitSkipped ) {\n\t\tthrow new Error( 'Compilation was unsuccessful!' );\n\t}\n}\n\nexport default handleErrors;\n","import { createProgram } from 'typescript';\nimport CompilerHost from './CompilerHost';\nimport handleErrors from './handleErrors';\n\nfunction compiler( files, options = {} ) {\n\tconst vfs = Object.assign( {}, files );\n\tconst compilerHost = new CompilerHost( vfs );\n\tconst program = createProgram( options.entry || [ 'index.ts' ], options, compilerHost );\n\n\tconst result = program.emit();\n\n\thandleErrors( program, result );\n\n\t// MUTATING STATE â€“ SO WRONG!!!\n\treturn vfs;\n}\n\nexport default compiler;\n"],"names":["CompilerHost","constructor","files","Array","isArray","TypeError","fileExists","fileName","existsSync","getCanonicalFileName","getCurrentDirectory","getDefaultLibFileName","getDefaultLibFilePath","options","getNewLine","getSourceFile","indexOf","readFileSync","createSourceFile","content","languageVersion","useCaseSensitiveFileNames","writeFile","data","handleErrors","getPreEmitDiagnostics","program","concat","emitResult","diagnostics","forEach","line","character","diagnostic","file","getLineAndCharacterOfPosition","start","flattenDiagnosticMessageText","messageText","chalk","blue","category","DiagnosticCategory","Warning","yellow","Error","red","console","method","prefix","message","errored","emitSkipped","compiler","Object","assign","vfs","createProgram","entry","compilerHost","emit","result"],"mappings":"qTAGA,KAAMA,aAAa,CAClBC,cAAqB,CACpB,GAAK,CAACC,CAAD,EAA2B,QAAjB,QAAOA,EAAjB,EAAuCC,MAAMC,OAAN,CAAeF,CAAf,CAA5C,CACC,KAAM,IAAIG,UAAJ,CAAe,oCAAf,CAAN,CAGD,KAAKH,KAAL,CAAaA,CACb,CAEDI,aAAuB,OACiB,WAAlC,QAAO,MAAKJ,KAAL,CAAYK,CAAZ,CADU,EAKfC,WAAYD,CAAZ,CACP,CAEDE,uBAAiC,CAChC,MAAeF,EAAf,GACA,CAEDG,qBAAsB,CACrB,MAAO,EACP,CAEDC,wBAAiC,CAChC,MAAOC,uBAAuBC,CAAvB,CACP,CAEDC,YAAa,CACZ,MAAO,IACP,CAEDC,kBAA2C,CAC1C,KAAM,GAA6C,CAAC,CAApC,KAASC,OAAT,CAAkB,UAAlB,GAAqE,CAAC,CAA7B,KAASA,OAAT,CAAkB,GAAlB,CAAzC,CACfC,aAAcV,CAAd,CAAwB,MAAxB,CADe,CACoB,KAAKL,KAAL,CAAYK,CAAZ,CADpC,CAGA,MAAOW,kBAAkBX,CAAlB,CAA4BY,CAA5B,CAAqCC,CAArC,CAAsD,KAAtD,IACP,CAEDC,2BAA4B,CAC3B,QACA,CAEDC,cAA4B,CAC3B,KAAKpB,KAAL,CAAYK,CAAZ,EAAyBgB,CACzB,CA9CiB,CCCnB,QAASC,aAAT,KAA6C,CAC5C,KAAM,GAAcC,sBAAuBC,CAAvB,EAAiCC,MAAjC,CAAyCC,EAAWC,WAApD,CAApB,CACA,GAAI,KAAJ,CAqBA,GAnBAA,EAAYC,OAAZ,CAAqB,KAAkB,CACtC,KAAM,CAAEC,MAAF,CAAQC,WAAR,EAAsBC,EAAWC,IAAX,CAAgBC,6BAAhB,CAA+CF,EAAWG,KAA1D,CAA5B,CACM,EAAUC,6BAA8BJ,EAAWK,WAAzC,CAAsD,IAAtD,CADhB,CAEA,GAAI,GAASC,MAAMC,IAAN,CAAY,QAAZ,CAAb,CACI,EAAS,KADb,CAGKP,EAAWQ,QAAX,GAAwBC,mBAAmBC,OANV,EAOrC,EAASJ,MAAMK,MAAN,CAAc,WAAd,CAP4B,CAQrC,EAAS,MAR4B,EAS1BX,EAAWQ,QAAX,GAAwBC,mBAAmBG,KATjB,GAUrC,EAASN,MAAMO,GAAN,CAAW,SAAX,CAV4B,CAWrC,EAAS,OAX4B,CAarC,IAbqC,EAgBtCC,QAASC,CAAT,EAAoB,GAAGC,CAAQ,IAAIhB,EAAWC,IAAX,CAAgB3B,QAAU,KAAKwB,EAAO,CAAG,IAAIC,EAAY,CAAG,MAAKkB,CAAQ,EAA5G,CACA,CAjBD,CAmBA,CAAKC,GAAWvB,EAAWwB,WAA3B,CACC,KAAM,IAAIP,MAAJ,CAAW,+BAAX,CAEP,CC1BD,QAASQ,WAAT,GAA0B,IAA1B,CAAyC,CACxC,KAAM,GAAMC,OAAOC,MAAP,IAAmBrD,CAAnB,CAAZ,CACM,EAAe,GAAIF,aAAJ,CAAkBwD,CAAlB,CADrB,CAEM,EAAUC,cAAe5C,EAAQ6C,KAAR,cAAf,CAAgD7C,CAAhD,CAAyD8C,CAAzD,CAFhB,CAIM,EAASjC,EAAQkC,IAAR,EAJf,CASA,MAHApC,cAAcE,CAAd,CAAuBmC,CAAvB,CAGA,CAAOL,CACP"}